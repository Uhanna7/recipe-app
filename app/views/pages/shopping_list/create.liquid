---
method: post
---

{% liquid
  assign array = "[]" | parse_json
  graphql prev_shopping_list = 'shopping_list/search'

  for item in prev_shopping_list.shopping_list.results[0].ingredient_ids
    assign array = array | array_add: item
  endfor

  graphql current_item = 'ingredient/search_by_name', name: context.params.name
  assign current_id = current_item.records.results[0].id

  if current_item.records.total_entries == 0
    graphql result_ingredient = 'ingredient/create', name: context.params.name
    assign current_id = result_ingredient.record.id
  endif

  assign index = array | array_index_of: current_id

  if index == null
    assign array = array | array_add: current_id
    graphql result = 'shopping_list/update', ingredient_ids: array, id: "215"
    if result.record.id
      redirect_to 'shopping_list/shopping-list'
    else
      echo 'Something went wrong'
      echo result.errors
    endif
  else
    echo 'You can add an ingredient to the shopping list only once'
  endif
%}