---
method: post
---

{% liquid

  graphql current_id = 'ingredient/search_by_name', name: context.params.name

  if current_id.records.total_entries == 0
    graphql result_ingredient = 'ingredient/create', name: context.params.name
  endif

  graphql id = 'ingredient/search_by_name', name: context.params.name
  assign ingredient_id = id.records.results[0].id

  graphql result = 'list_item/create', ingredient_id: ingredient_id

  if result.record.id
    redirect_to 'shopping_list/shopping-list'
  else
    echo 'Something went wrong'
    echo result.errors
  endif
%}